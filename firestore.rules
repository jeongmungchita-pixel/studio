/**
 * @file Firebase Security Rules for KGF Nexus (Production)
 * @description Role-based access control with domain-based architecture
 * 
 * Roles (defined in /src/constants/roles.ts):
 * - SUPER_ADMIN: Full system access
 * - FEDERATION_ADMIN: Federation-wide access
 * - CLUB_OWNER: Own club management access
 * - CLUB_MANAGER: Own club operational access
 * - COACH: Class and member management
 * - MEMBER: Own data access only
 * 
 * Domain Structure:
 * - Auth: Authentication and user management
 * - Member: Member data and operations
 * - Club: Club data and operations
 * - Business: Financial and administrative data
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // ============================================
    // ğŸ”§ Helper Functions
    // ============================================
    
    function isAuthenticated() {
      return request.auth != null;
    }

    // Drafts: ì˜¨ë³´ë”© ì¤‘ ì„ì‹œ ì €ì¥ (ë³¸ì¸ ì „ìš©)
    match /adultRegistrationDrafts/{uid} {
      allow read, create, update, delete: if isAuthenticated() && request.auth.uid == uid;
    }
    match /familyRegistrationDrafts/{uid} {
      allow read, create, update, delete: if isAuthenticated() && request.auth.uid == uid;
    }
    
    function getUserData() {
      return get(/databases/$(database)/documents/users/$(request.auth.uid)).data;
    }
    
    function isSuperAdmin() {
      return isAuthenticated() && getUserData().role == 'SUPER_ADMIN';
    }
    
    function isFederationAdmin() {
      return isAuthenticated() && getUserData().role == 'FEDERATION_ADMIN';
    }
    
    function isClubOwner() {
      return isAuthenticated() && getUserData().role == 'CLUB_OWNER';
    }
    
    function isClubManager() {
      return isAuthenticated() && getUserData().role == 'CLUB_MANAGER';
    }
    
    function isCoach() {
      return isAuthenticated() && getUserData().role == 'COACH';
    }
    
    function isHeadCoach() {
      return isAuthenticated() && getUserData().role == 'HEAD_COACH';
    }

    function isAssistantCoach() {
      return isAuthenticated() && getUserData().role == 'ASSISTANT_COACH';
    }

    function isClubStaff() {
      return isClubOwner() || isClubManager() || isCoach() || isHeadCoach() || isAssistantCoach();
    }
    
    
    function isAdmin() {
      return isSuperAdmin() || isFederationAdmin();
    }
    
    function belongsToClub(clubId) {
      return isAuthenticated() && getUserData().clubId == clubId;
    }

    // Helper: resolve requested club from request payload or existing resource
    function reqClubId() {
      return request.resource.data.requestedClubId != null
        ? request.resource.data.requestedClubId
        : resource.data.requestedClubId;
    }

    function reqClubName() {
      return request.resource.data.requestedClubName != null
        ? request.resource.data.requestedClubName
        : resource.data.requestedClubName;
    }

    // Helper: if approver also links a member in the same write, validate by that member's club
    function memberClubIdFromRequest() {
      return request.resource.data.linkedMemberId != null
        ? get(/databases/$(database)/documents/members/$(request.resource.data.linkedMemberId)).data.clubId
        : null;
    }

    function matchesApproverClub() {
      return (
        (reqClubId() != null && reqClubId() == getUserData().clubId) ||
        (
          reqClubName() != null &&
          getUserData().clubName != null &&
          reqClubName() == getUserData().clubName
        ) ||
        (memberClubIdFromRequest() != null && memberClubIdFromRequest() == getUserData().clubId)
      );
    }

    // ============================================
    // ğŸ‘¤ Users Collection
    // ============================================
    
    // Helper: Check if sensitive fields are being modified
    function hasSensitiveFields() {
      let diff = request.resource.data.diff(resource.data).affectedKeys();
      return 'status' in diff || 
             'role' in diff || 
             'linkedMemberId' in diff ||
             'clubId' in diff ||
             'clubName' in diff;
    }
    
    match /users/{userId} {
      // ìê¸° í”„ë¡œí•„ ì½ê¸°: ë³¸ì¸ì€ í•­ìƒ ê°€ëŠ¥ (ìˆœí™˜ ì°¸ì¡° ë°©ì§€)
      allow read: if isAuthenticated() && request.auth.uid == userId;
      
      // ë‹¤ë¥¸ ì‚¬ìš©ì í”„ë¡œí•„ ì½ê¸°: ê´€ë¦¬ìë§Œ (ìµœì í™”: í•œ ë²ˆë§Œ ì²´í¬)
      allow read: if isAuthenticated() && 
                     get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role in ['SUPER_ADMIN', 'FEDERATION_ADMIN'];
      
      // í”„ë¡œí•„ ìƒì„±: ë³¸ì¸ë§Œ
      allow create: if isAuthenticated() && request.auth.uid == userId;
      
      // í”„ë¡œí•„ ìˆ˜ì •: ë³¸ì¸ì€ ë¯¼ê° í•„ë“œ ì œì™¸, ê´€ë¦¬ìëŠ” ëª¨ë‘ ê°€ëŠ¥
      allow update: if isAuthenticated() && (
                        // ë³¸ì¸: ë¯¼ê° í•„ë“œ ìˆ˜ì • ë¶ˆê°€
                        (request.auth.uid == userId && !hasSensitiveFields()) ||
                        // ê´€ë¦¬ì: ëª¨ë“  í•„ë“œ ìˆ˜ì • ê°€ëŠ¥
                        get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role in ['SUPER_ADMIN', 'FEDERATION_ADMIN']
                      );
      
      // í”„ë¡œí•„ ì‚­ì œ: ê´€ë¦¬ìë§Œ (ìµœì í™”)
      allow delete: if isAuthenticated() && 
                       get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role in ['SUPER_ADMIN', 'FEDERATION_ADMIN'];
      
      // ì „ì²´ ëª©ë¡: ê´€ë¦¬ìë§Œ (ìµœì í™”)
      allow list: if isAuthenticated() && 
                     get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role in ['SUPER_ADMIN', 'FEDERATION_ADMIN'];
    }

    // ============================================
    // ğŸ¢ Clubs Collection
    // ============================================
    
    match /clubs/{clubId} {
      // ì½ê¸°: ê³µê°œ (ê°€ì…/ë“±ë¡ í˜ì´ì§€ì—ì„œ í´ëŸ½ ì„ íƒì„ ìœ„í•´ í•„ìš”)
      allow read: if true;
      
      // ìƒì„±: ê´€ë¦¬ìë§Œ (í´ëŸ½ ë“±ë¡ ìŠ¹ì¸ í›„ ìƒì„±)
      allow create: if isAdmin();
      
      // ìˆ˜ì •: ê´€ë¦¬ì ë˜ëŠ” í•´ë‹¹ í´ëŸ½ ì˜¤ë„ˆ
      allow update: if isAdmin() || 
                       (isAuthenticated() && 
                        resource.data.ownerId == request.auth.uid);
      
      // ì‚­ì œ: ê´€ë¦¬ìë§Œ
      allow delete: if isAdmin();
      
      // ì „ì²´ ëª©ë¡ ì¡°íšŒ: ê³µê°œ
      allow list: if true;
    }

    // ============================================
    // ğŸ‘¥ Members Collection
    // ============================================
    
    // Helper: Check if member sensitive fields are being modified
    function hasMemberSensitiveFields() {
      let diff = request.resource.data.diff(resource.data).affectedKeys();
      return 'status' in diff || 
             'userId' in diff || 
             'clubId' in diff ||
             'guardianUserIds' in diff;
    }
    
    match /members/{memberId} {
      // ì½ê¸°: í´ëŸ½ ìŠ¤íƒœí”„, ê´€ë¦¬ì, ë˜ëŠ” ë³¸ì¸
      allow read: if isAuthenticated() && (
                      isAdmin() || 
                      (isClubStaff() && belongsToClub(resource.data.clubId)) ||
                      resource.data.userId == request.auth.uid ||
                      request.auth.uid in resource.data.guardianUserIds
                    );
      
      // ìƒì„±: APIë§Œ (Admin SDK)
      allow create: if false;
      
      // ìˆ˜ì •: ë³¸ì¸ì€ ì¼ë¶€ í•„ë“œë§Œ, ìŠ¤íƒœí”„/ê´€ë¦¬ìëŠ” API ì‚¬ìš©
      allow update: if isAuthenticated() && 
                       resource.data.userId == request.auth.uid && 
                       !hasMemberSensitiveFields();
      
      // ì‚­ì œ: APIë§Œ (Admin SDK)
      allow delete: if false;
      
      // ëª©ë¡ ì¡°íšŒ: ê´€ë¦¬ì ë˜ëŠ” í´ëŸ½ ìŠ¤íƒœí”„
      allow list: if isAdmin() || isClubStaff();
    }

    // ============================================
    // ğŸ† Competitions Collection
    // ============================================
    
    match /competitions/{competitionId} {
      // ì½ê¸°: ì¸ì¦ëœ ì‚¬ìš©ì
      allow read: if isAuthenticated();
      
      // ìƒì„±/ìˆ˜ì •/ì‚­ì œ: ê´€ë¦¬ìë§Œ
      allow create, update, delete: if isAdmin();
    }

    // ============================================
    // ğŸ“ Level Tests Collection
    // ============================================
    
    match /level_tests/{levelTestId} {
      // ì½ê¸°: ì¸ì¦ëœ ì‚¬ìš©ì
      allow read: if isAuthenticated();
      
      // ìƒì„±/ìˆ˜ì •/ì‚­ì œ: ê´€ë¦¬ì ë˜ëŠ” í´ëŸ½ ìŠ¤íƒœí”„
      allow create, update, delete: if isAdmin() || isClubStaff();
    }

    // ============================================
    // ğŸ“‹ Requests Collections
    // ============================================
    
    match /clubOwnerRequests/{requestId} {
      // ì½ê¸°: ê´€ë¦¬ì ë˜ëŠ” ë³¸ì¸
      allow read: if isAdmin() || (isAuthenticated() && resource.data.userId == request.auth.uid);
      
      // ìƒì„±: ëˆ„êµ¬ë‚˜ ê°€ëŠ¥ (ê°€ì… ì‹ ì²­ì€ ë¹„íšŒì›ë„ ê°€ëŠ¥)
      allow create: if true;
      
      // ìˆ˜ì •/ì‚­ì œ: ê´€ë¦¬ìë§Œ
      allow update, delete: if isAdmin();
    }
    
    match /superAdminRequests/{requestId} {
      // ì½ê¸°/ìˆ˜ì •/ì‚­ì œ: SUPER_ADMINë§Œ
      allow read, update, delete: if isSuperAdmin();
      
      // ìƒì„±: ëˆ„êµ¬ë‚˜ ê°€ëŠ¥ (ìµœê³  ê´€ë¦¬ì ì‹ ì²­)
      allow create: if true;
    }
    
    match /federationAdminInvites/{inviteId} {
      // ì½ê¸°: ëˆ„êµ¬ë‚˜ (ì´ˆëŒ€ ë§í¬ë¥¼ í†µí•œ ì ‘ê·¼ í—ˆìš©)
      allow read: if true;
      
      // ìƒì„±: ê´€ë¦¬ìë§Œ
      allow create: if isSuperAdmin();
      
      // ìˆ˜ì •: ê´€ë¦¬ì ë˜ëŠ” ì´ˆëŒ€ë°›ì€ ì‚¬ëŒ (ê°€ì… ì‹œ ìƒíƒœ ì—…ë°ì´íŠ¸)
      allow update: if isSuperAdmin() || (isAuthenticated() && resource.data.email == request.auth.token.email);
      
      // ì‚­ì œ: ê´€ë¦¬ìë§Œ
      allow delete: if isSuperAdmin();
    }
    

    // Standardized collection name
    match /coach_requests/{requestId} {
      // ì½ê¸°: ê´€ë¦¬ì ë˜ëŠ” ìš”ì²­í•œ ì‚¬ìš©ì(ë³¸ì¸)
      allow read: if isAdmin() || (isAuthenticated() && resource.data.requestedBy == request.auth.uid);

      // ìƒì„±: í´ëŸ½ ìŠ¤íƒœí”„ & ë³¸ì¸ í´ëŸ½ì— ëŒ€í•´ì„œë§Œ í—ˆìš©
      allow create: if isClubStaff() && belongsToClub(request.resource.data.clubId);

      // ìˆ˜ì •/ì‚­ì œ: ê´€ë¦¬ìë§Œ
      allow update, delete: if isAdmin();
    }
    
    match /memberRegistrationRequests/{requestId} {
      // ì½ê¸°: ê´€ë¦¬ì ë˜ëŠ” í•´ë‹¹ í´ëŸ½ ìŠ¤íƒœí”„ (clubId ë˜ëŠ” clubName ê¸°ì¤€ í—ˆìš©)
      allow read: if isAdmin() || (
        isClubStaff() && (
          belongsToClub(resource.data.clubId) ||
          (
            resource.data.clubName != null &&
            getUserData().clubName != null &&
            getUserData().clubName == resource.data.clubName
          )
        )
      );
      
      // ìƒì„±: APIë§Œ (íšŒì›ê°€ì… í”„ë¡œì„¸ìŠ¤)
      allow create: if false;
      
      // ìˆ˜ì •: APIë§Œ (ìŠ¹ì¸/ê±°ë¶€ í”„ë¡œì„¸ìŠ¤)
      allow update: if false;
      
      // ì‚­ì œ: APIë§Œ
      allow delete: if false;
    }
    
    // ì„±ì¸ íšŒì› ê°€ì… ì‹ ì²­
    match /adultRegistrationRequests/{requestId} {
      // ì½ê¸°: ê´€ë¦¬ì ë˜ëŠ” í•´ë‹¹ í´ëŸ½ ìŠ¤íƒœí”„ (clubId ë˜ëŠ” clubName ê¸°ì¤€ í—ˆìš©)
      allow read: if isAdmin() || (
        isClubStaff() && (
          belongsToClub(resource.data.clubId) ||
          (
            resource.data.clubName != null &&
            getUserData().clubName != null &&
            getUserData().clubName == resource.data.clubName
          )
        )
      );
      
      // ìƒì„±: APIë§Œ (íšŒì›ê°€ì… í”„ë¡œì„¸ìŠ¤)
      allow create: if false;
      
      // ìˆ˜ì •: APIë§Œ (ìŠ¹ì¸/ê±°ë¶€ í”„ë¡œì„¸ìŠ¤)
      allow update: if false;
      
      // ì‚­ì œ: APIë§Œ
      allow delete: if false;
    }
    
    // ê°€ì¡± íšŒì› ê°€ì… ì‹ ì²­
    match /familyRegistrationRequests/{requestId} {
      // ì½ê¸°: ê´€ë¦¬ì ë˜ëŠ” í•´ë‹¹ í´ëŸ½ ìŠ¤íƒœí”„ (clubId ë˜ëŠ” clubName ê¸°ì¤€ í—ˆìš©)
      allow read: if isAdmin() || (
        isClubStaff() && (
          belongsToClub(resource.data.clubId) ||
          (
            resource.data.clubName != null &&
            getUserData().clubName != null &&
            getUserData().clubName == resource.data.clubName
          )
        )
      );
      
      // ìƒì„±: APIë§Œ (íšŒì›ê°€ì… í”„ë¡œì„¸ìŠ¤)
      allow create: if false;
      
      // ìˆ˜ì •: APIë§Œ (ìŠ¹ì¸/ê±°ë¶€ í”„ë¡œì„¸ìŠ¤)
      allow update: if false;
      
      // ì‚­ì œ: APIë§Œ
      allow delete: if false;
    }
    
    // Deprecated: memberRequestsëŠ” memberRegistrationRequestsë¡œ í†µí•©ë¨
    match /memberRequests/{requestId} {
      allow read, write: if false; // ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
    }

    // ============================================
    // ğŸ« Passes & Attendance (Domain: Member)
    // ============================================
    
    match /member_passes/{passId} {
      // ì½ê¸°: ê´€ë¦¬ì, í´ëŸ½ ìŠ¤íƒœí”„, ë³¸ì¸
      allow read: if isAdmin() || isClubStaff() || (isAuthenticated() && resource.data.memberId == request.auth.uid);
      
      // ìƒì„±/ìˆ˜ì •/ì‚­ì œ: APIë§Œ (Admin SDK)
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }
    
    match /attendance/{attendanceId} {
      // ì½ê¸°: ê´€ë¦¬ì, í´ëŸ½ ìŠ¤íƒœí”„, ë³¸ì¸
      allow read: if isAdmin() || isClubStaff() || (isAuthenticated() && resource.data.memberId == request.auth.uid);
      
      // ìƒì„±/ìˆ˜ì •/ì‚­ì œ: ê´€ë¦¬ì ë˜ëŠ” í´ëŸ½ ìŠ¤íƒœí”„
      allow create, update, delete: if isAdmin() || isClubStaff();
    }

    // ============================================
    // ğŸ“š Classes & Templates (Domain: Club)
    // ============================================
    
    match /gym_classes/{classId} {
      allow read: if isAuthenticated();
      allow create, update, delete: if isAdmin() || isClubStaff();
    }
    
    match /classes/{classId} {
      allow read: if isAuthenticated();
      allow create, update, delete: if isAdmin() || isClubStaff();
    }
    
    match /pass_templates/{templateId} {
      // ì½ê¸°: ì¸ì¦ëœ ì‚¬ìš©ì
      allow read: if isAuthenticated();
      // ìƒì„±/ìˆ˜ì •/ì‚­ì œ: ê´€ë¦¬ì ë˜ëŠ” í´ëŸ½ ìŠ¤íƒœí”„ (í…œí”Œë¦¿ ê´€ë¦¬ëŠ” í—ˆìš©)
      allow create, update, delete: if isAdmin() || isClubStaff();
    }
    
    // ì´ìš©ê¶Œ ìš”ì²­ (ì‹ ê·œ/ê°±ì‹ )
    match /pass_requests/{requestId} {
      // ì½ê¸°: ê´€ë¦¬ì, í´ëŸ½ ìŠ¤íƒœí”„, ë˜ëŠ” ìš”ì²­ì ë³¸ì¸
      allow read: if isAdmin() || 
                     isClubStaff() || 
                     (isAuthenticated() && resource.data.requestedBy == request.auth.uid);
      
      // ìƒì„±: ì¸ì¦ëœ ì‚¬ìš©ì (íšŒì›/í•™ë¶€ëª¨ê°€ ì‹ ì²­)
      allow create: if isAuthenticated();
      
      // ìˆ˜ì •: APIë§Œ (ìŠ¹ì¸/ê±°ë¶€ ì²˜ë¦¬)
      allow update: if false;
      
      // ì‚­ì œ: APIë§Œ
      allow delete: if false;
    }
    
    // ë ˆê±°ì‹œ: pass_renewal_requests (pass_requestsë¡œ í†µí•©ë¨)
    match /pass_renewal_requests/{requestId} {
      // ì½ê¸°: ê¸°ì¡´ ë¡œì§ ìœ ì§€ (í•˜ìœ„í˜¸í™˜)
      allow read: if isAdmin() || isClubStaff();
      
      // ì“°ê¸°: ëª¨ë‘ ì°¨ë‹¨ (pass_requests ì‚¬ìš©)
      allow create, update, delete: if false;
    }

    // ============================================
    // ğŸ“¸ Media Collection
    // ============================================
    
    match /media/{mediaId} {
      allow read: if isAuthenticated();
      allow create, update, delete: if isAdmin() || isClubStaff();
    }

    // ============================================
    // ğŸ’° Financial Collections (Domain: Business)
    // ============================================
    
    match /payments/{paymentId} {
      allow read: if isAdmin() || isClubStaff();
      allow create, update: if isAdmin() || isClubStaff();
      allow delete: if isAdmin();
    }
    
    match /financial_transactions/{transactionId} {
      allow read: if isAdmin() || (isClubStaff() && belongsToClub(resource.data.clubId));
      allow create: if isAdmin() || isClubStaff();
      allow update, delete: if isAdmin() || (isClubStaff() && belongsToClub(resource.data.clubId));
    }
    
    match /incomes/{incomeId} {
      allow read: if isAdmin() || isClubStaff();
      allow create, update, delete: if isAdmin() || isClubStaff();
    }
    
    match /expenses/{expenseId} {
      allow read: if isAdmin() || isClubStaff();
      allow create, update, delete: if isAdmin() || isClubStaff();
    }
    
    match /budgets/{budgetId} {
      allow read: if isAdmin() || isClubStaff();
      allow create, update, delete: if isAdmin() || isClubStaff();
    }

    // ============================================
    // ğŸ“¢ Announcements & Messages (Domain: Business)
    // ============================================
    
    match /announcements/{announcementId} {
      allow read: if isAuthenticated();
      allow create, update, delete: if isAdmin() || isClubStaff();
    }
    
    match /messageHistory/{messageId} {
      allow read: if isAdmin() || isClubStaff();
      allow create: if isAdmin() || isClubStaff();
      allow update, delete: if isAdmin();
    }

    // ============================================
    // âš™ï¸ Settings Collections
    // ============================================
    
    match /club_bank_accounts/{accountId} {
      allow read: if isAdmin() || belongsToClub(accountId);
      allow create, update, delete: if isAdmin() || (isClubStaff() && belongsToClub(accountId));
    }
    
    match /naverCloudConfigs/{configId} {
      allow read: if isAdmin() || belongsToClub(configId);
      allow create, update, delete: if isAdmin() || (isClubStaff() && belongsToClub(configId));
    }

    // ============================================
    // ğŸ›ï¸ Committees (ìœ„ì›íšŒ)
    // ============================================
    
    match /committees/{committeeId} {
      // ì½ê¸°: ì¸ì¦ëœ ì‚¬ìš©ì
      allow read: if isAuthenticated();
      
      // ìƒì„±/ìˆ˜ì •/ì‚­ì œ: ê´€ë¦¬ìë§Œ
      allow create, update, delete: if isAdmin();
    }

    // ============================================
    // ğŸ‰ Events & Registrations (í´ëŸ½ ì´ë²¤íŠ¸)
    // ============================================
    
    match /events/{eventId} {
      // ì½ê¸°: ì¸ì¦ëœ ì‚¬ìš©ì
      allow read: if isAuthenticated();
      
      // ìƒì„±/ìˆ˜ì •/ì‚­ì œ: ê´€ë¦¬ì ë˜ëŠ” í´ëŸ½ ìŠ¤íƒœí”„
      allow create, update, delete: if isAdmin() || isClubStaff();
    }
    
    match /event_registrations/{registrationId} {
      // ì½ê¸°: ê´€ë¦¬ì, í´ëŸ½ ìŠ¤íƒœí”„, ë³¸ì¸
      allow read: if isAdmin() || isClubStaff() || (isAuthenticated() && resource.data.memberId == request.auth.uid);
      
      // ìƒì„±: ì¸ì¦ëœ ì‚¬ìš©ì
      allow create: if isAuthenticated();
      
      // ìˆ˜ì •: APIë§Œ
      allow update: if false;
      
      // ì‚­ì œ: APIë§Œ
      allow delete: if false;
    }

    // ============================================
    // ğŸ“ Level Test Registrations (ìŠ¹ê¸‰ì‹¬ì‚¬ ì°¸ê°€)
    // ============================================
    
    match /level_test_registrations/{registrationId} {
      // ì½ê¸°: ê´€ë¦¬ì, í´ëŸ½ ìŠ¤íƒœí”„, ë³¸ì¸
      allow read: if isAdmin() || isClubStaff() || (isAuthenticated() && resource.data.memberId == request.auth.uid);
      
      // ìƒì„±: APIë§Œ
      allow create: if false;
      
      // ìˆ˜ì •: APIë§Œ
      allow update: if false;
      
      // ì‚­ì œ: APIë§Œ
      allow delete: if false;
    }

    // ============================================
    // ğŸ† Competition Registrations (ëŒ€íšŒ ì°¸ê°€)
    // ============================================
    
    match /competition_registrations/{registrationId} {
      // ì½ê¸°: ê´€ë¦¬ì, í´ëŸ½ ìŠ¤íƒœí”„, ë³¸ì¸
      allow read: if isAdmin() || isClubStaff() || (isAuthenticated() && resource.data.memberId == request.auth.uid);
      
      // ìƒì„±: APIë§Œ
      allow create: if false;
      // ìƒì„±: ì¸ì¦ëœ ì‚¬ìš©ì
      allow create: if isAuthenticated();
      
      // ìˆ˜ì •/ì‚­ì œ: ê´€ë¦¬ìë§Œ
      allow update, delete: if isAdmin();
    }

    // ============================================
    // âš–ï¸ Judges (ì‹¬íŒ)
    // ============================================
    
    match /judges/{judgeId} {
      // ì½ê¸°: ì¸ì¦ëœ ì‚¬ìš©ì
      allow read: if isAuthenticated();
      
      // ìƒì„±/ìˆ˜ì •/ì‚­ì œ: ê´€ë¦¬ìë§Œ
      allow create, update, delete: if isAdmin();
    }

    // ============================================
    // ğŸš« Deny all other access
    // ============================================
    
    // ëª…ì‹œë˜ì§€ ì•Šì€ ëª¨ë“  ì ‘ê·¼ ì°¨ë‹¨
  }
}